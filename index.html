<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Valentine?</title>

<style>
  *{ box-sizing:border-box; }

  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    background:linear-gradient(135deg,#ffe1ef,#fff7e1);
    overflow-y:auto;
    overflow-x:hidden;
    padding:24px 0;
  }

  .heart{
    position:absolute;
    bottom:-40px;
    font-size:18px;
    opacity:.7;
    animation:floatUp linear forwards;
    pointer-events:none;
  }
  @keyframes floatUp{
    from{transform:translateY(0);opacity:0}
    10%{opacity:.7}
    to{transform:translateY(-110vh);opacity:0}
  }

  .layout{
    width:min(1200px,96vw);
    display:grid;
    grid-template-columns:220px minmax(560px,1fr) 220px;
    gap:20px;
    align-items:start;
  }
  .side{
    display:flex;
    flex-direction:column;
    gap:14px;
  }
  .side img{
    width:100%;
    height:170px;
    object-fit:cover;
    border-radius:18px;
    box-shadow:0 10px 22px rgba(0,0,0,.08);
    background:#fff;
  }

  @media (max-width: 900px){
    .layout{ grid-template-columns:1fr; }
    .side{
      flex-direction:row;
      overflow-x:auto;
      padding-bottom:6px;
    }
    .side img{
      flex:0 0 160px;
      height:150px;
    }
  }

  .card{
    width:100%;
    padding:28px;
    border-radius:18px;
    background:rgba(255,255,255,.95);
    box-shadow:0 10px 30px rgba(0,0,0,.12);
    text-align:center;
    position:relative;
    overflow:hidden;
  }

  h1{margin:0 0 10px;font-size:28px}
  h2{margin:0 0 14px;font-size:22px}

  .meterWrap{
    width:90%;
    height:10px;
    margin:0 auto 8px;
    background:rgba(0,0,0,.1);
    border-radius:999px;
    overflow:hidden;
  }
  .meter{
    height:100%;
    width:0%;
    background:#ff2d7a;
    transition:width .2s;
  }
  .meterLabel{font-size:13px;margin-bottom:16px;font-weight:750;opacity:.8}

  .btns{
    display:flex;
    justify-content:center;
    gap:12px;
    position:relative;
    height:76px;
    margin-bottom:4px;
  }

  button{
    border:none;
    padding:12px 18px;
    border-radius:999px;
    font-weight:800;
    cursor:pointer;
    user-select:none;
  }

  #yes{background:#ff2d7a;color:#fff}

  #no{
    background:#222;color:#fff;
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    will-change:left,top;
  }

  .msg{margin-top:14px;font-weight:850;min-height:24px}

  .plan{display:none;margin-top:18px}
  .smallBtn{
    background:#111;color:#fff;
    padding:8px 14px;
    border-radius:999px;
    margin:4px;
    font-weight:850;
  }
  .ghostBtn{
    background:transparent;
    border:2px solid rgba(0,0,0,.3);
    padding:8px 14px;
    border-radius:999px;
    font-weight:850;
  }

  .slideshow{
    display:none;
    margin-top:16px;
    border-radius:14px;
    overflow:hidden;
    border:1px solid rgba(0,0,0,.08);
    box-shadow:0 10px 22px rgba(0,0,0,.08);
    background:#fff;
  }
  .slideFrame{
    position:relative;
    width:100%;
    aspect-ratio: 16 / 10;
    background:#0b0b0b;
  }
  .slideFrame img{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit:contain;
    opacity:0;
    transition:opacity .35s ease;
  }
  .slideFrame img.active{opacity:1}
  .slideControls{
    display:flex;
    gap:10px;
    justify-content:center;
    align-items:center;
    padding:10px 12px;
  }
  .dotRow{display:flex;gap:6px;flex-wrap:wrap;justify-content:center}
  .dot{width:8px;height:8px;border-radius:99px;background:rgba(0,0,0,.18)}
  .dot.on{background:#ff2d7a}
  .tiny{font-size:12px;opacity:.75;font-weight:800}

  canvas{position:absolute;inset:0;pointer-events:none}

  /* ‚úÖ SECURITY GATE */
  .gate{
    position:fixed;
    inset:0;
    display:flex;
    justify-content:center;
    align-items:center;
    padding:18px;
    background:rgba(0,0,0,.55);
    backdrop-filter: blur(6px);
    z-index:9999;
  }
  .gateCard{
    width:min(520px, 92vw);
    background:rgba(255,255,255,.96);
    border-radius:18px;
    box-shadow:0 18px 50px rgba(0,0,0,.22);
    padding:18px;
    text-align:center;
  }
  .qBox{
    margin-top:10px;
    padding:14px;
    border-radius:14px;
    background:#fff;
    border:1px solid rgba(0,0,0,.08);
  }
  .q{
    font-weight:900;
    margin-bottom:10px;
    font-size:16px;
  }
  .gateInput{
    width:min(360px, 90%);
    padding:10px 12px;
    border-radius:999px;
    border:1px solid #ccc;
    font-weight:800;
    outline:none;
  }
  .gateBtns{
    margin-top:10px;
    display:flex;
    gap:10px;
    justify-content:center;
    flex-wrap:wrap;
  }
  .gateMsg{
    margin-top:10px;
    font-weight:900;
    min-height:22px;
  }

  /* üí¨ Message Wall */
  .messages{
    margin-top:18px;
    padding-top:8px;
    border-top:1px solid rgba(0,0,0,.08);
    display:none; /* shown after YES */
  }
  .msgForm{
    display:flex;
    gap:10px;
    justify-content:center;
    flex-wrap:wrap;
    margin:10px 0 6px;
  }
  .msgForm input{
    padding:10px 12px;
    border-radius:999px;
    border:1px solid #ccc;
    font-weight:800;
    outline:none;
  }
  #msgName{ min-width:160px; }
  #msgText{ min-width:min(420px, 90vw); }

  .msgTools{
    display:flex;
    justify-content:center;
    margin:6px 0 10px;
  }

  .msgList{
    display:flex;
    flex-direction:column;
    gap:10px;
    max-height:260px;
    overflow:auto;
    padding:6px 4px;
  }

  .msgCard{
    background:#fff;
    border:1px solid rgba(0,0,0,.08);
    border-radius:14px;
    padding:10px 12px;
    box-shadow:0 8px 18px rgba(0,0,0,.06);
    text-align:left;
  }
  .msgTop{
    display:flex;
    justify-content:space-between;
    gap:10px;
    align-items:center;
    margin-bottom:6px;
  }
  .msgMeta{
    font-weight:950;
    font-size:13px;
    opacity:.85;
  }
  .msgTime{
    font-size:12px;
    opacity:.6;
    font-weight:850;
    white-space:nowrap;
  }
  .msgBody{
    font-weight:850;
    line-height:1.25;
    word-wrap:break-word;
  }
</style>
</head>

<body>

<!-- ‚úÖ Security Gate Overlay -->
<div class="gate" id="gate" role="dialog" aria-modal="true" aria-label="Security Question">
  <div class="gateCard">
    <h2 style="margin:0 0 6px;">Quick security question üîí</h2>
    <p style="margin:0 0 12px; font-weight:700; opacity:.85;">Answer to unlock the question:</p>

    <div class="qBox">
      <div class="q" id="gateQ">Security Question</div>

      <input id="gateA" type="password" autocomplete="off" placeholder="Type answer‚Ä¶" class="gateInput" />

      <div class="gateBtns">
        <button class="ghostBtn" id="gateHint">Hint</button>
        <button class="smallBtn" id="gateUnlock">Unlock üíò</button>
      </div>

      <div class="gateMsg" id="gateMsg"></div>
    </div>
  </div>
</div>

<div class="layout">
  <!-- ‚úÖ LEFT SIDE PHOTOS -->
  <aside class="side" aria-label="Side photos left">
    <img src="./Me1.JPG" alt="Me 1">
    <img src="./Me2.jpeg" alt="Me 2">
    <img src="./Me3.jpeg" alt="Me 3">
  </aside>

  <div class="card" id="card">
    <canvas id="confetti"></canvas>

    <h1>Xhensila ‚ù§Ô∏è</h1>
    <h2>Will you be my Valentine? üíò</h2>

    <div class="meterWrap"><div class="meter" id="meter"></div></div>
    <div class="meterLabel" id="meterLabel">Convincing you‚Ä¶ 0%</div>

    <div class="btns" id="btns">
      <button id="yes">Yes üíó</button>
      <button id="no">No üôÉ</button>
    </div>

    <div class="msg" id="msg"></div>

    <div class="slideshow" id="slideshow">
      <div class="slideFrame" id="slideFrame"></div>
      <div class="slideControls">
        <button class="ghostBtn" id="prevSlide">‚óÄ</button>
        <div>
          <div class="dotRow" id="dots"></div>
          <div class="tiny" id="slideLabel">1 / 1</div>
        </div>
        <button class="ghostBtn" id="nextSlide">‚ñ∂</button>
      </div>
    </div>

    <div class="plan" id="plan">
      <h3 style="margin:0 0 8px;">Okayyyy it‚Äôs official üíñ</h3>
      <p style="margin:0 0 10px;">Pick a plan (or type your own):</p>

      <div>
        <button class="smallBtn planOpt" data-idea="Dinner + dessert üçùüç∞">Dinner + dessert üçùüç∞</button>
        <button class="smallBtn planOpt" data-idea="Movie night + snacks üé¨üçø">Movie night + snacks üé¨üçø</button>
        <button class="smallBtn planOpt" data-idea="Coffee + walk + pics ‚òïÔ∏èüö∂‚Äç‚ôÄÔ∏èüì∏">Coffee + walk + pics ‚òïÔ∏èüö∂‚Äç‚ôÄÔ∏èüì∏</button>
        <button class="smallBtn planOpt" data-idea="Bowling + arcade üé≥üïπÔ∏è">Bowling + arcade üé≥üïπÔ∏è</button>
        <button class="smallBtn planOpt" data-idea="Picnic (indoors if cold) üß∫üíó">Picnic üß∫üíó</button>
        <button class="smallBtn planOpt" data-idea="Mini road trip + playlist üöóüé∂">Mini road trip üöóüé∂</button>
      </div>

      <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
        <input id="customIdea" type="text" placeholder="Type your own idea..."
          style="padding:8px 12px; border-radius:999px; border:1px solid #ccc; font-weight:800; min-width:240px;">
        <button class="ghostBtn" id="submitIdea">Use this üíå</button>
        <button class="ghostBtn" id="copyTxt">Copy message ‚ú®</button>
      </div>

      <p id="planMsg" style="margin-top:10px; font-weight:950;"></p>

      <!-- üí¨ Message Wall -->
      <div class="messages" id="messagesBox">
        <h3 style="margin:16px 0 8px;">Leave a message üíå</h3>

        <div class="msgForm">
          <input id="msgName" type="text" placeholder="Name (optional)" maxlength="24">
          <input id="msgText" type="text" placeholder="Type a message..." maxlength="180">
          <button class="smallBtn" id="sendMsg">Send</button>
        </div>

        <div class="msgTools">
          <button class="ghostBtn" id="clearInputs">Clear inputs</button>
        </div>

        <div class="msgList" id="msgList"></div>
      </div>
    </div>
  </div>

  <!-- ‚úÖ RIGHT SIDE PHOTOS -->
  <aside class="side" aria-label="Side photos right">
    <img src="./Me4.jpeg" alt="Me 4">
    <img src="./Me5.jpeg" alt="Me 5">
    <img src="./Me6.jpeg" alt="Me 6">
  </aside>
</div>

<script type="module">
  /* ===========================
     ‚úÖ Firebase (CDN) + Firestore
     =========================== */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    serverTimestamp,
    query,
    orderBy,
    onSnapshot,
    limit
  } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

  // ‚úÖ Firebase config (yours)
  const firebaseConfig = {
    apiKey: "AIzaSyByrG8yhLFIBv2blOLcmsu9vlWL4nDQ3g",
    authDomain: "valentine-3fa85.firebaseapp.com",
    projectId: "valentine-3fa85",
    storageBucket: "valentine-3fa85.firebasestorage.app",
    messagingSenderId: "351065784635",
    appId: "1:351065784635:web:1a7dc2e477129f86fb371e",
    measurementId: "G-CWMMM8Z2DD"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const messagesCol = collection(db, "messages");

  /* =======================
     DOM refs
     ======================= */
  const card = document.getElementById("card");
  const btns = document.getElementById("btns");
  const yesBtn = document.getElementById("yes");
  const noBtn = document.getElementById("no");
  const msg = document.getElementById("msg");
  const meter = document.getElementById("meter");
  const meterLabel = document.getElementById("meterLabel");
  const plan = document.getElementById("plan");
  const planMsg = document.getElementById("planMsg");

  const slideshow = document.getElementById("slideshow");
  const slideFrame = document.getElementById("slideFrame");
  const dots = document.getElementById("dots");
  const slideLabel = document.getElementById("slideLabel");
  const prevSlideBtn = document.getElementById("prevSlide");
  const nextSlideBtn = document.getElementById("nextSlide");

  // Message wall
  const messagesBox = document.getElementById("messagesBox");
  const msgName = document.getElementById("msgName");
  const msgText = document.getElementById("msgText");
  const sendMsg = document.getElementById("sendMsg");
  const clearInputs = document.getElementById("clearInputs");
  const msgList = document.getElementById("msgList");

  /* =========================================================
     ‚úÖ SECURITY GATE SETTINGS ‚Äî EDIT THESE 3 LINES
     ========================================================= */
  const SECURITY_QUESTION = "When was our first kiss?"; // <-- EDIT THIS LINE
  const SECURITY_ANSWER   = "August 20";                   // <-- EDIT THIS LINE
  const SECURITY_HINT     = "Valentine‚Äôs Day üòâ";        // <-- EDIT THIS LINE

  // Gate elements
  const gate = document.getElementById("gate");
  const gateQ = document.getElementById("gateQ");
  const gateA = document.getElementById("gateA");
  const gateMsg = document.getElementById("gateMsg");
  const gateUnlock = document.getElementById("gateUnlock");
  const gateHint = document.getElementById("gateHint");

  // Hide main content until unlocked
  const layout = document.querySelector(".layout");
  layout.style.filter = "blur(12px)";
  layout.style.pointerEvents = "none";
  layout.style.userSelect = "none";

  gateQ.textContent = SECURITY_QUESTION;

  function normalize(s){
    return (s || "")
      .toLowerCase()
      .trim()
      .replace(/\s+/g, " ");
  }

  function unlockIfCorrect(){
    const guess = normalize(gateA.value);
    const answer = normalize(SECURITY_ANSWER);

    if (!guess){
      gateMsg.textContent = "Type an answer first üòÑ";
      return;
    }

    if (guess === answer){
      gateMsg.textContent = "Unlocked ‚úÖ";
      gate.style.display = "none";
      layout.style.filter = "none";
      layout.style.pointerEvents = "auto";
      layout.style.userSelect = "auto";
      return;
    }

    gateMsg.textContent = "Nope üôÉ try again";
    gateA.value = "";
    gateA.focus();
  }

  gateUnlock.addEventListener("click", unlockIfCorrect);
  gateA.addEventListener("keydown", (e) => {
    if (e.key === "Enter") unlockIfCorrect();
  });
  gateHint.addEventListener("click", () => {
    gateMsg.textContent = "Hint: " + SECURITY_HINT;
  });
  setTimeout(() => gateA.focus(), 80);

  /* ===========================
     Hearts background
     =========================== */
  function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }
  function spawnHeart() {
    const h = document.createElement("div");
    h.className = "heart";
    h.textContent = Math.random() < 0.7 ? "üíó" : "üíñ";
    h.style.left = randomInt(0, 100) + "vw";
    h.style.animationDuration = randomInt(4000, 8000) + "ms";
    h.style.fontSize = randomInt(14, 28) + "px";
    document.body.appendChild(h);
    setTimeout(() => h.remove(), 8500);
  }
  setInterval(spawnHeart, 500);

  /* ===========================
     Confetti
     =========================== */
  const canvas = document.getElementById("confetti");
  const ctx = canvas.getContext("2d");
  function resizeCanvas(){
    canvas.width = card.clientWidth;
    canvas.height = card.clientHeight;
  }
  resizeCanvas();
  window.addEventListener("resize", resizeCanvas);

  let confetti = [];
  function burstConfetti() {
    resizeCanvas();
    confetti = [];
    for (let i = 0; i < 160; i++) {
      confetti.push({
        x: canvas.width / 2,
        y: canvas.height / 2,
        vx: (Math.random() - 0.5) * 9,
        vy: (Math.random() - 1.0) * 9,
        g: 0.22,
        a: 1
      });
    }
    requestAnimationFrame(updateConfetti);
  }
  function updateConfetti() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    confetti.forEach(p => {
      p.vy += p.g;
      p.x += p.vx;
      p.y += p.vy;
      p.a -= 0.012;
      ctx.globalAlpha = Math.max(0, p.a);
      ctx.fillStyle = "#ff2d7a";
      ctx.fillRect(p.x, p.y, 4, 4);
    });
    ctx.globalAlpha = 1;
    confetti = confetti.filter(p => p.a > 0);
    if (confetti.length) requestAnimationFrame(updateConfetti);
  }

  /* ===========================
     Meter + buttons
     =========================== */
  let noCount = 0;

  function setMeter(pct) {
    meter.style.width = pct + "%";
    meterLabel.textContent = `Convincing you‚Ä¶ ${pct}%`;
  }

  function typeText(el, text) {
    el.textContent = "";
    let i = 0;
    const t = setInterval(() => {
      el.textContent += text[i++];
      if (i >= text.length) clearInterval(t);
    }, 25);
  }

  function moveNoButton() {
    const padding = 8;
    const areaW = btns.clientWidth;
    const areaH = btns.clientHeight;

    const maxLeft = areaW - noBtn.offsetWidth - padding;
    const maxTop  = areaH - noBtn.offsetHeight - padding;

    const left = randomInt(padding, Math.max(padding, maxLeft));
    const top  = randomInt(padding, Math.max(padding, maxTop));

    noBtn.style.left = left + "px";
    noBtn.style.top = top + "px";
    noBtn.style.transform = "translate(0,0)";
  }

  noBtn.addEventListener("click", (e) => {
    e.preventDefault();
    noCount++;
    setMeter(Math.min(noCount * 18, 95));
    moveNoButton();
    yesBtn.style.transform = `scale(${1 + Math.min(0.45, noCount * 0.06)})`;
  });

  noBtn.addEventListener("mouseenter", () => {
    if (!noBtn.disabled) moveNoButton();
  });

  /* ===========================
     Slideshow
     =========================== */
  const photos = [
    "photo1.jpg",
    "photo2.jpeg",
    "photo3.jpeg",
    "photo4.jpeg",
    "photo5.JPG"
  ];

  let currentSlide = 0;
  let slideTimer = null;

  function renderSlideshow() {
    slideFrame.innerHTML = "";
    dots.innerHTML = "";

    photos.forEach((src, idx) => {
      const img = document.createElement("img");
      img.src = src;
      img.alt = "Photo " + (idx + 1);
      img.loading = "lazy";
      if (idx === currentSlide) img.classList.add("active");
      slideFrame.appendChild(img);

      const d = document.createElement("div");
      d.className = "dot" + (idx === currentSlide ? " on" : "");
      d.addEventListener("click", () => goToSlide(idx));
      dots.appendChild(d);
    });

    slideLabel.textContent = `${currentSlide + 1} / ${photos.length}`;
  }

  function goToSlide(idx) {
    currentSlide = (idx + photos.length) % photos.length;

    const imgs = slideFrame.querySelectorAll("img");
    imgs.forEach((im, i) => im.classList.toggle("active", i === currentSlide));

    const dotEls = dots.querySelectorAll(".dot");
    dotEls.forEach((d, i) => d.classList.toggle("on", i === currentSlide));

    slideLabel.textContent = `${currentSlide + 1} / ${photos.length}`;
    startAutoplay();
  }

  function nextSlide() { goToSlide(currentSlide + 1); }
  function prevSlide() { goToSlide(currentSlide - 1); }

  function startAutoplay() {
    if (slideTimer) clearInterval(slideTimer);
    if (photos.length > 1) slideTimer = setInterval(nextSlide, 2500);
  }

  prevSlideBtn.addEventListener("click", prevSlide);
  nextSlideBtn.addEventListener("click", nextSlide);

  slideshow.addEventListener("mouseenter", () => slideTimer && clearInterval(slideTimer));
  slideshow.addEventListener("mouseleave", startAutoplay);

  /* ===========================
     Plans
     =========================== */
  document.querySelectorAll(".planOpt").forEach(btn => {
    btn.addEventListener("click", () => {
      planMsg.textContent = "Perfect üòç Our plan: " + btn.dataset.idea;
    });
  });

  const customIdea = document.getElementById("customIdea");
  document.getElementById("submitIdea").addEventListener("click", () => {
    const idea = customIdea.value.trim();
    if (!idea) { planMsg.textContent = "Type something first üòÑ"; return; }
    planMsg.textContent = "Perfect üòç Our plan: " + idea;
  });

  customIdea.addEventListener("keydown", (e) => {
    if (e.key === "Enter") document.getElementById("submitIdea").click();
  });

  document.getElementById("copyTxt").addEventListener("click", async () => {
    try {
      const extra = planMsg.textContent ? ("\n" + planMsg.textContent) : "";
      await navigator.clipboard.writeText("Happy Valentine‚Äôs Day üíñ I‚Äôm really happy you‚Äôre my person ü•∞" + extra);
      planMsg.textContent = "Copied ‚úÖ";
    } catch {
      planMsg.textContent = "Copy blocked by browser üò≠";
    }
  });

  /* ===========================
     ‚úÖ Firestore Message Wall
     =========================== */
  function fmtTimeFromFirestore(ts){
    if (!ts) return "";
    try{
      // Firestore Timestamp has toDate()
      const d = ts.toDate ? ts.toDate() : new Date(ts);
      return d.toLocaleString(undefined, { month:"short", day:"2-digit", hour:"2-digit", minute:"2-digit" });
    }catch{
      return "";
    }
  }

  function renderFirestoreMessages(snapshot){
    msgList.innerHTML = "";
    if (snapshot.empty){
      msgList.innerHTML = `<div style="opacity:.7;font-weight:850;text-align:center;">No messages yet üôÇ</div>`;
      return;
    }

    snapshot.forEach(docSnap => {
      const data = docSnap.data() || {};
      const name = (data.name || "Anonymous").toString().slice(0, 24);
      const text = (data.text || "").toString().slice(0, 180);
      const time = fmtTimeFromFirestore(data.createdAt);

      const c = document.createElement("div");
      c.className = "msgCard";
      c.innerHTML = `
        <div class="msgTop">
          <div class="msgMeta">${name}</div>
          <div class="msgTime">${time}</div>
        </div>
        <div class="msgBody"></div>
      `;
      c.querySelector(".msgBody").textContent = text;
      msgList.appendChild(c);
    });
  }

  // Real-time listener (latest 50)
  const msgQuery = query(messagesCol, orderBy("createdAt", "desc"), limit(50));
  onSnapshot(msgQuery, (snap) => renderFirestoreMessages(snap), (err) => {
    msgList.innerHTML = `<div style="opacity:.7;font-weight:850;text-align:center;">Messages not loading (check Firestore Rules) üò≠</div>`;
    console.error(err);
  });

  async function addMessage(){
    const name = (msgName.value || "").trim().slice(0, 24);
    const text = (msgText.value || "").trim().slice(0, 180);
    if (!text){ msgText.focus(); return; }

    sendMsg.disabled = true;
    sendMsg.textContent = "Sending‚Ä¶";

    try{
      await addDoc(messagesCol, {
        name: name || "Anonymous",
        text,
        createdAt: serverTimestamp()
      });
      msgText.value = "";
      msgText.focus();
    }catch(e){
      alert("Couldn‚Äôt send message. Check Firestore Rules.");
      console.error(e);
    }finally{
      sendMsg.disabled = false;
      sendMsg.textContent = "Send";
    }
  }

  sendMsg.addEventListener("click", addMessage);
  msgText.addEventListener("keydown", (e) => { if (e.key === "Enter") addMessage(); });

  clearInputs.addEventListener("click", () => {
    msgName.value = "";
    msgText.value = "";
    msgText.focus();
  });

  /* ===========================
     YES button (show extras)
     =========================== */
  yesBtn.addEventListener("click", () => {
    yesBtn.disabled = true;
    noBtn.disabled = true;

    setMeter(100);
    typeText(msg, "Yayyy!! üíñü•∞ I knew you'd say yes!");
    burstConfetti();

    slideshow.style.display = "block";
    plan.style.display = "block";
    messagesBox.style.display = "block";

    currentSlide = 0;
    renderSlideshow();
    startAutoplay();

    setTimeout(() => slideshow.scrollIntoView({ behavior: "smooth", block: "nearest" }), 200);
  });
</script>

</body>
</html>
